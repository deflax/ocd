#!/usr/bin/env bash

set -e

# Get the directory where the script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Configuration
IMAGE_NAME="ocd:latest"

# Get current user's UID and GID
USER_UID="$(id -u)"
USER_GID="$(id -g)"

# Build the image with host user's UID/GID
echo "Building Docker image: ${IMAGE_NAME}"
echo "Using UID=${USER_UID}, GID=${USER_GID}"
docker build \
    --build-arg UID="${USER_UID}" \
    --build-arg GID="${USER_GID}" \
    -t "${IMAGE_NAME}" \
    "${SCRIPT_DIR}"

echo "Build completed successfully!"